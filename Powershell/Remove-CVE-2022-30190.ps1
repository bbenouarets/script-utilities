# This scirpt will remove the vulerability CVE-2022-30190 (alias Follina) from your system.
# You run this script on your own risk. I take no responsibility for any damage caused by this script.

function Export-RegistryKey {
    param (
        [Parameter(Mandatory=$true)]
        [string]$RootKey,
        [Parameter(Mandatory=$true)]
        [string]$Key,
        [Parameter(Mandatory=$true)]
        [string]$ExportPath
    )

    if (Test-Path -Path $ExportPath) {
        # Delete the existing file
        Remove-Item -Path $ExportPath -Force
    }

    reg export $RootKey\$Key $ExportPath
}

function Remove-RegistryKey {
    param (
        [Parameter(Mandatory=$true)]
        [string]$RootKey,
        [Parameter(Mandatory=$true)]
        [string]$Key
    )

    reg delete $RootKey\$Key /f
}

function Remove-CVE-2022-30190 {
    Export-RegistryKey -RootKey "HKCR" -Key "ms-msdt" -ExportPath "./ms-msdt.reg"
    Remove-RegistryKey -RootKey "HKCR" -Key "ms-msdt"
}

Remove-CVE-2022-30190