function remove7zipVulnerability() {
    $7zip = "$env:ProgramFiles\7-Zip"

    # Check if the folder exists
    if (Test-Path -Path $7zip) {
        Write-Host -ForegroundColor Green "7-Zip is installed!"
    }

    $vulnerabilityFile = "$7zip\7-zip.chm"
    # Check if the file exists
    if (!(Test-Path -Path $vulnerabilityFile)) {
        Write-Host -ForegroundColor Green "7-Zip is not vulnerable!"
        return
    }

    # Detect the version of 7-Zip
    $registry = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\7-Zip"
    $registryItem = Get-ItemProperty $registry | Select-Object DisplayVersion
    if ($registryItem.DisplayVersion -eq "21.07") {
        Write-Host -ForegroundColor Red "7-Zip is vulnerable! Please remove the file $vulnerabilityFile!"
        Write-Host "In the next step, you will be asked to remove the file $vulnerabilityFile."
        Read-Host "Please press [ENTER] to continue..."
        try {
            Remove-Item -Path $vulnerabilityFile -Force | Out-Null
            if (!(Test-Path -Path $vulnerabilityFile)) {
                Write-Host -ForegroundColor Green "Vulnerability has been removed!"
            } else {
                Write-Host -ForegroundColor Red "Vulnerability could not be removed! Are you sure you have admin privileges? Run the script as administrator."
            }
        }
        catch {
            Write-Host -ForegroundColor Red "Failed to remove the file $vulnerabilityFile! Are you sure you have admin privileges? Run the script as administrator."
            return
        }
    } else {
        Write-Host -ForegroundColor Green "7-Zip is not vulnerable!"
    }
}

remove7zipVulnerability